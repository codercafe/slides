<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

  <title>Testing</title>

  <link rel="stylesheet" href="../reveal.js/css/reveal.css">
  <link rel="stylesheet" href="../reveal.js/css/theme/simple.css">

  <!-- Theme used for syntax highlighting of code -->
  <link rel="stylesheet" href="../reveal.js/lib/css/zenburn.css">

  <!-- Printing and PDF exports -->
  <script>
    var link = document.createElement('link');
    link.rel = 'stylesheet';
    link.type = 'text/css';
    link.href = window.location.search.match(/print-pdf/gi) ? '../reveal.js/css/print/pdf.css' : '../reveal.js/css/print/paper.css';
    document.getElementsByTagName('head')[0].appendChild(link);
  </script>
</head>

<body>
  <div class="reveal">
    <div class="slides">
      <section>
        <h1>Code Academy</h1>
        <h3>Session #1: Testing (Java)</h3>
        <p>
          <small>Created by
            <a href="https://github.com/larsp">Lars</a>,
            <a href="https://github.com/frankwis">Frank</a> &amp;
            <a href="https://github.com/utobi">Tobi</a></small>
        </p>
      </section>

      <section>
        <section data-background="img/testing.jpg">
          <h1>Testing?</h1>
          <small><a href="https://flic.kr/p/8jZ45h">Role Reversal</a> by Kenny Louie - Some rights reserved <a href="https://creativecommons.org/licenses/by/2.0/">CC BY 2.0</a></small>
          <aside class="notes">
            tbd
          </aside>
        </section>
        <section>
          <p><q class="fragment">"I don't know how to write tests."&nbsp;</q></p>
          <p><q class="fragment">"I don't have enough time to write tests."&nbsp;</q></p>
          <p><q class="fragment">"Testing is not my job."&nbsp;</q></p>
          <p><q class="fragment">"Writing tests is too hard."&nbsp;</q></p>
          <p><q class="fragment">"My code is too simple for tests."&nbsp;</q></p>
          <p><q class="fragment">...</q></p>
          <h2 class="fragment">all &#128169;</h2>
        </section>
        <section>
          <h2>Motivation</h2>
          <p>
            <ul>
              <li class="fragment">Does it work?</li>
              <li class="fragment">Is the Bug fixed?</li>
              <li class="fragment">Documentation</li>
              <li class="fragment">Enable change</li>
              <li class="fragment">Constrain Features</li>
              <li class="fragment">Improve Design</li>
              <li class="fragment">Faster Development</li>
            </ul>
          </p>
          <div class="fragment">&rarr; Fundamental Discipline</div>
          <aside class="notes">
            Reduce Fear
            Reduce Bugs in New Features<br/>
            Reduce Bugs in Existing Features<br/>
            Are Good Documentation<br/>
            Reduce the Cost of Change<br/>
            Allow Refactoring<br/>
            Improve Design<br/>
            Constrain Features<br/>
            Defend Against Other Programmers<br/>
            Forces You to Slow Down and Think<br/>
            Makes Development Faster<br/>
          </aside>
        </section>

        <section>
          <h2>Testing!</h2>
          <ul>
            <li class="fragment">Unit Testing</li>
            <li class="fragment">Integration Testing</li>
            <li class="fragment">Black box / Acceptance / Functional Testing</li>
            <li class="fragment">Performance Testing</li>
            <li class="fragment">...</li>
          </ul>
        </section>
      </section>

      <section>
        <section>
          <h1>Unit Testing</h1>

          <aside class="notes">
          </aside>
        </section>

        <section>
          <h2>Class to be tested</h2>
          <pre class="fragment"><code data-trim class="java">
public class SpelloutCalculator {
    public String add(int x, int y) {...};
    public String subtract(int minuend, int sutrahend) {...};
    public String multiply(int x, int y) {...};
    public String divide(int divident, int divisor) {...};
    public List&lt;String&gt; primeFactorization(int number) {...};
}
          </code></pre>
          <pre class="fragment"><code data-trim class="java">
calculator.divide(12, 3)  // returns "four"
calculator.divide(-10, 4) // returns "minus two point five"
calculator.primeFactorization(35) // returns ["five", "seven"]
          </code></pre>
          <aside class="notes">
            tbd
          </aside>
        </section>
        <section>
          <h2>JUnit (4)</h2>
          <pre class="fragment"><code data-trim class="java">
@Test
public void add() {
    SpelloutCalculator calculator = new SpelloutCalculator();
    assertEquals("fifteen", calculator.add(12, 3));
    assertEquals("fourteen", calculator.add(10, 4));
    assertEquals("minus seven", calculator.add(7, -14));
}
          </code></pre>
          <pre class="fragment"><code data-trim class="java">
@Test
public void divide() {
    SpelloutCalculator calculator = new SpelloutCalculator();
    assertEquals("four", calculator.divide(12, 3));
    assertEquals("two point five", calculator.divide(10, 4));
    assertEquals("minus two point five", calculator.divide(-10, 4));
}
          </code></pre>
          <pre class="fragment"><code data-trim class="java">
@Ignore("Order does matter")
@Test
public void primeFactorization() {
    SpelloutCalculator calculator = new SpelloutCalculator();
    assertEquals(calculator.primeFactorization(35), Arrays.asList("five", "seven"));
    assertEquals(calculator.primeFactorization(35), Arrays.asList("seven", "five"));
}
          </code></pre>
          <aside class="notes">
            JUnit4, 5 will be similar, not TestNG, but this is not important
          </aside>
        </section>

        <section>
          <h2>Hamcrest</h2>
          <aside class="notes">
            <ul>
              <li>Readability</li>
              <li>Extendable</li>
            </ul>
          </aside>
        </section>
        <!--  -->
        <section>
          <h3>Provided Hamcrest Matcher</h3>
          <pre class="fragment"><code data-trim class="java">
@Test
public void divideWithMatchers() {
  SpelloutCalculator calculator = new SpelloutCalculator();
  assertThat(calculator.divide(12, 3), is(equalTo("four")));
  assertThat(calculator.divide(10, 4), is(equalTo("two point five")));
}
          </code></pre>
          <pre class="fragment"><code data-trim class="java">
@Test
public void primeFactorization() {
    SpelloutCalculator calculator = new SpelloutCalculator();
    assertThat(calculator.primeFactorization(350), hasItems("two", "five", "seven"));
}
          </code></pre>
          <pre class="fragment"><code data-trim class="java">
@Test
public void primeFactorizationCustomMatcher() {
    SpelloutCalculator calculator = new SpelloutCalculator();
    assertThat(calculator.primeFactorization(350), hasAllItems("two", "five", "five", "seven"));
    assertThat(calculator.primeFactorization(350), not(hasAllItems("two", "five", "seven")));
}
          </code></pre>
        </section>

        <section>
          <h3>Custom Hamcrest Matcher</h3>
          <pre><code data-trim class="java">
@Test
public void primeFactorizationCustomMatcher() {
    SpelloutCalculator calculator = new SpelloutCalculator();
    assertThat(calculator.primeFactorization(350), hasAllItems("two", "five", "five", "seven"));
    assertThat(calculator.primeFactorization(350), not(hasAllItems("two", "five", "seven")));
}
        </code></pre>
        </section>
        <section>
          <h3>Custom Hamcrest Matcher</h3>
          <small><pre><code data-trim class="java">
private &lt;T&gt; Matcher&lt;Collection&lt;T&gt;&gt; hasAllItems(final T... items) {
    return new TypeSafeMatcher&lt;Collection&lt;T&gt;&gt;() {

        @Override
        public boolean matchesSafely(final Collection&lt;T&gt; item) {
            if (items.length != item.size()) {
                return false;
            }

            Map&lt;T, Long&gt; counts = item
                        .stream()
                        .collect(groupingBy(element -> element, counting()));
            for (T value : counts.keySet()) {
                if (Collections.frequency(item, value) != counts.get(value)) {
                    return false;
                }
            }

            return true;
        }

        @Override
        public void describeTo(final Description description) {
            description.appendText("a collection containing ").appendValue(items).appendText( " in arbitrary order");
        }
    };
}
        </code></pre></small>
        <aside class="notes">
          <pre>
TypeSafeMatcher                            >> BaseMatcher >> Matcher
CustomMatcher (implements describeTo)      >> BaseMatcher
CustomTypeSafeMatcher (implements describeTo) >> TypeSafeMatcher (implements type safety and not null) >> BaseMatcher
TypeSafeDiagnosingMatcher (type safety, not null woth diagnosis >> BaseMatcher
          </pre>
        </aside>


        </section>

        <section>
          <h2>Exception Testing</h2>
          <pre><code data-trim class="java">
@Test(expected = ArithmeticException.class)
public void divideByNull() {
    SpelloutCalculator calculator = new SpelloutCalculator();
    calculator.divide(12, 0);
}
          </code></pre>
          <pre><code data-trim class="java">
@Rule
public final ExpectedException expected = ExpectedException.none();

@Test
public void divideByNullTestRule() {
    SpelloutCalculator calculator = new SpelloutCalculator();
    expected.expect(ArithmeticException.class);
    expected.expectMessage("Cannot divide by null");
    calculator.divide(12, 0);
}
           </code></pre>
        </section>

        <section>
          <h2>Mocking with Mockito</h2>
          <aside class="notes">
            defactor standard in our team with the most active communit on GitHub (+3300 stargazers)
          </aside>
        </section>
        <section>
          <h2>Remember<sup><small>1</small></sup></h2>
          <ul>
            <li>Do not mock types you don’t own</li>
            <li>Don’t mock value objects</li>
            <li>Don’t mock everything</li>
            <li>Show love with your tests!</li>
          </ul>
          <p><small>[1] <a href="http://mockito.org/" target="_blank">mockito.org</a></small></p>
        </section>

        <section>
          <h2>Antipatterns</h2>
          <p>
            tbd
          </p>
        </section>

        <section>
          <h2>Guava Testutils</h2>
          <small>Class to be tested:</small>
          <pre><code data-trim class="java">
public class StringVector3D implements Serializable {

  public final String x, y, z;

  public StringVector3D(String x, String y, String z) throws ParseException {...}

  public StringVector3D(int x, int y, int z) {
    this.x = format(x);
    this.y = format(y);
    this.z = format(z);
  }

  @Override
  public boolean equals(Object o) {...}

  @Override
  public int hashCode() {...}

}
          </code></pre>
        </section>
        <section>
          <h3>NPEs and Serializables</h3>
          <pre class="fragment"><code data-trim class="java">
@Test
public void nullPointerException() {
    new NullPointerTester()
          .setDefault(String.class, "null")
          .testAllPublicConstructors(StringVector3D.class);
}
          </code></pre>
          <pre class="fragment"><code data-trim class="java">
@Test
public void serializable() throws ParseException {
    SerializableTester.reserializeAndAssert(new StringVector3D("one", "two", "three"));
}
          </code></pre>
          <aside class="notes">
            <ul>
              <li>NullPointerTester
                <ul>
                  <li>A test utility that verifies that your methods/constructors throw <tt>NPE</tt>s or <tt>UnsupportedOperationException</tt> whenever null is passed to a parameter that isn't annotated with <tt>Nullable</tt>.</li>
                  <li><tt>setDefault</tt> provides a custom non-null default value for the parameter type.</li>
                </ul>
              </li>
              <li>SerializableTester
                <ul>
                  <li>Tests serialization and deserialization of an object, optionally asserting that the resulting object is equal to the original.</li>
                  <li><tt>reserializeAndAssert</tt> calls EqualsTester</li>
                  <li><tt>reserialize</tt> just serializes and reserializes via ByteStream</li>
                </ul>
              </li>
            </ul>
          </aside>
        </section>

        <section>
          <h3>EqualsTester</h3>
          <pre class="fragment"><code data-trim class="java">
StringVector3D vector1 = new StringVector3D(3, 2, 1);

// object against null returns false
assertFalse(vector1.equals(null));
// incompatible class returns false
assertFalse(vector1.equals(new WordCalculator()));
// different parameters result in inequality
assertFalse(vector1.equals(new StringVector3D(1, 2, 3)));
// object against itself returns true
assertTrue(vector1.equals(vector1));
// same parameters result in equality
assertTrue(vector1.equals(new StringVector3D(3, 2, 1)));
// hash code matches on equality
assertEquals(vector1.hashCode(), new StringVector3D(3, 2, 1).hashCode());
          </code></pre>
          <pre class="fragment"><code data-trim class="java">
// What about the String constructor?
new StringVector3D("three", "two", "one");
          </code></pre>
          <pre class="fragment"><code data-trim class="java">
new EqualsTester()
          .addEqualityGroup(new StringVector3D(1, 2, 3),
                  new StringVector3D("one", "two", "three"))
          .addEqualityGroup(new StringVector3D(0, 0, 0),
                  StringVector3D.ZERO)
          .testEquals();
          </code></pre>

          <aside class="notes">
            EqualsTester:
            <ul>
              <li>comparing each object against itself returns true</li>
              <li>comparing each object against null returns false</li>
              <li>comparing each object against an instance of an incompatible class returns false</li>
              <li>comparing each pair of objects within the same equality group returns true</li>
              <li>comparing each pair of objects from different equality groups returns false</li>
              <li>the hash codes of any two equal objects are equal</li>
            </ul>
          </aside>
        </section>
        <section>
          <h2>Test Coverage</h2>
          <p>
            tbd
          </p>
        </section>

        <section>
          <h2>Async Testing</h2>
          <small>Class to be tested:<br />
            <pre><code data-trim class="java">
public class LazyFibonacciCalculator {

    private final RuleBasedNumberFormat spelloutFormatter = new RuleBasedNumberFormat(ENGLISH, SPELLOUT);
    private static Logger logger = LoggerFactory.getLogger(LazyFibonacciCalculator.class);
    private AtomicReference&lt;String&gt; value = new AtomicReference&lt;&gt;();

    public void calculate(int number) {
        new Thread(() -> {
            if (number == 1 || number == 2) {
                value.set(spelloutFormatter.format(1));
            }
            int lastFibonacci = 1, currentFibonacci = 1, result = 1;
            for (int i = 3; i <= number; i++) {
                result = lastFibonacci + currentFibonacci;
                lastFibonacci = currentFibonacci;
                currentFibonacci = result;

                // let's be lazy
                try {
                    Thread.sleep(50 + random.nextInt(1000));
                } catch (InterruptedException ex) {
                    logger.warn("Couldn't be lazy.", ex);
                }

            }
            value.set(spelloutFormatter.format(result));
        }).start();
    }

    public String getResult() {
        return value.get();
    }
}
            </code></pre>
          </small>
        </section>

        <section>
          <h2>Awaitility</h2>
          <pre class="fragment"><code data-trim class="java">
@Ignore("Bad pattern: Sleep duration unforeseeable.")
@Test
public void calculateWithThreadSleep() throws InterruptedException {
    LazyFibonacciCalculator calculator = new LazyFibonacciCalculator();
    calculator.calculate(20);
    assertNull(calculator.getResult());
    Thread.sleep(15000);
    assertThat(calculator.getResult(), is(equalTo("six thousand seven hundred sixty-five")));
}
          </code></pre>
          <pre class="fragment"><code data-trim class="java">
@Test
public void calculateWithAwaitility() {
    LazyFibonacciCalculator calculator = new LazyFibonacciCalculator();
    calculator.calculate(20);
    await().until(calculator::getResult, is(equalTo("six thousand seven hundred sixty-five")));
}
          </code></pre>
        </section>

        <section data-background="img/tea_time.jpg">
          <h1>Tea Time</h1>
          <small><a href="https://flic.kr/p/irWvoG">Tea Time</a> by Prayitno Hadinata - Some rights reserved <a href="https://creativecommons.org/licenses/by/2.0/">CC BY 2.0</a></small>
          <aside class="notes">
            tbd
          </aside>
        </section>
        <section>
          <q cite="http://martinfowler.com/articles/continuousIntegration.html">
            Imperfect tests, run frequently, are much better than perfect tests that are never written at all.<br/> --Martin Fowler
          </q>
        </section>


        <section>
          <h2 class="fragment">What are your test requirements?</h2>
          <aside class="notes">
            More important than test tools, apis, frameworks are your test requirements.
          </aside>
        </section>
      </section>


    </div>
  </div>

  <script src="../reveal.js/lib/js/head.min.js"></script>
  <script src="../reveal.js/js/reveal.js"></script>

  <script>
    // More info https://github.com/hakimel/reveal.js#configuration
    Reveal.initialize({
      controls: true,
      progress: true,
      history: true,
      center: true,
      slideNumber: 'c/t',
      transition: 'slide', // none/fade/slide/convex/concave/zoom
      /*width: 1024,
      height: 768,
      margin: 0.1,
      minScale: 0.75,
      maxScale: 1.2,*/

      // More info https://github.com/hakimel/reveal.js#dependencies
      dependencies: [{
        src: '../reveal.js/plugin/markdown/marked.js'
      }, {
        src: '../reveal.js/plugin/markdown/markdown.js'
      }, {
        src: '../reveal.js/plugin/notes/notes.js',
        async: true
      }, {
        src: '../reveal.js/plugin/highlight/highlight.js',
        async: true,
        callback: function() {
          hljs.initHighlightingOnLoad();
        }
      }]
    });
  </script>
</body>

</html>
